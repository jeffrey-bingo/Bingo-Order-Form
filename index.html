<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Order Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-container {
            max-height: 60vh;
            overflow-y: auto;
        }
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .category-btn.active {
            background-color: #2563EB; /* a blue-600 shade */
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Customer Order Form</h1>
            <p class="text-gray-600 mb-8">Please fill out your details and select the products you wish to order.</p>

            <!-- Customer Information Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label for="customerName" class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                    <input type="text" id="customerName" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-1">Company Name (Optional)</label>
                    <input type="text" id="companyName" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="email" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" id="phone" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>
                <div class="md:col-span-2">
                    <label for="shippingAddress" class="block text-sm font-medium text-gray-700 mb-1">Shipping Address</label>
                    <textarea id="shippingAddress" rows="3" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                </div>
                 <div class="md:col-span-2">
                    <label for="specialInstructions" class="block text-sm font-medium text-gray-700 mb-1">Special Instructions</label>
                    <textarea id="specialInstructions" rows="3" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                </div>
            </div>

            <!-- Product Table Section -->
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Products</h2>

            <!-- Category Filter Section -->
            <div class="mb-4">
                <h3 class="text-lg font-medium text-gray-800 mb-3">Filter by Category:</h3>
                <div id="category-filters" class="flex flex-wrap gap-2">
                    <button class="category-btn active bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="All">All</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="140">ALL PLAY TICKETS</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="145">.50 CENT GAMES</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="150">FLASH GAMES</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="155">FLASH GAMES $1199+</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="170">MINI STRIPS (3V)</button>
                    <button class="category-btn bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-lg text-sm font-semibold transition" data-category="180">STRIP GAMES (5V)</button>
                </div>
            </div>

            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="Search for a product within the selected category..." class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
            </div>
            
            <div class="table-container border border-gray-200 rounded-lg">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky-header">
                        <tr>
                            <th scope="col" class="hidden px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item Code</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product Name</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price per deal</th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-32">Quantity</th>
                            <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Line Total</th>
                        </tr>
                    </thead>
                    <tbody id="product-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Product rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Order Summary and Submission -->
            <div class="mt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <h3 class="text-2xl font-bold text-gray-900">Total: <span id="total-price">$0.00</span></h3>
                </div>
                <button id="submit-order" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 ease-in-out transform hover:-translate-y-0.5">
                    Submit Order
                </button>
            </div>
        </div>
    </div>
    
    <!-- Success Message -->
    <div id="success-message" class="fixed top-5 right-5 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg z-50 hidden" role="alert">
        <strong class="font-bold">Success!</strong>
        <span class="block sm:inline">Your email client is opening to send the order.</span>
    </div>

    <!-- Modal for Order Summary -->
    <div id="order-summary-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 m-4 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Order Summary</h2>
            <div id="modal-customer-details" class="mb-6 border-b pb-4"></div>
            <h3 class="text-xl font-semibold text-gray-800 mb-2">Selected Products:</h3>
            <div id="modal-product-summary" class="mb-6 max-h-60 overflow-y-auto"></div>
            <div class="text-right font-bold text-xl text-gray-900 mb-6 border-t pt-4">
                Total: <span id="modal-total-price"></span>
            </div>
            <div class="flex justify-end gap-4">
                <button id="close-modal" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg transition-colors">Close</button>
                <button id="confirm-order" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">Confirm & Send Email</button>
            </div>
        </div>
    </div>


    <script>
        const inventoryData = `
140,TP6445Y,"DUMB CLUCKS $1 /210 /48CS",13.10
140,TP6446Y,"BOSS HOG $1 /210 /48CS",13.10
140,TP6447Y,"FUR BABIES $1 /210 /48CS",13.10
140,TP6448Y,"SILLY GOOSE $1 /210 /48CS",13.10
140,TP6499H,"LUCKY CHARMED $1 /210 /48CS",13.10
140,TP6500H,"HIGH ROLLER $1 /210 /48CS",13.10
140,TP6501H,"COOKIES $1 /210 /48CS",13.10
140,TP6502H,"FUNKY FARM $1 /210 /48CS",13.10
140,TPLS210,"LICKETY SPLIT $1 /210 /48CS",13.10
145,UM6044W,"JELLY BEANZ .50 /1740 /4CS",84.50
150,TP15527,"AROUND THE STRIP $1 /984 /8CS",47.75
150,TP15945AR,"GRAND SLAM $1 /1770 /4CS",85.80
150,TP17639R,"BLAZIN BALLS $1 /480 /12CS",23.25
150,TP17737AR,"SUPER SLAM $1 /1770 /4CS",85.80
150,TP21160,"BLOCKBUSTER $1 /624 /12CS",30.25
150,TP21161,"QUICK HITZ $1 /624 /12CS",30.25
150,TP23673RR,"BONUS SLAM $1 /1740 /4CS",84.50
150,TP25246R,"BIG DADDY $1 /1260 /6CS",61.10
150,TP27148R,"HOT MAMA $1 /1260 /6CS",61.10
150,TP32673R,"DOUBLE DABBIN $1 /1260/8CS",61.10
150,TP35738R,"BLAZING BALLS $1 /930 /8CS",45.10
150,TP36140R,"FIRE BALLS $1 /968 /8CS",46.95
150,TP6144V,"LUCKY GEMS $1 /975 /8CS",47.30
150,TP6145V,"ROCK & ROLL $1 /975 /8CS",47.30
150,TP6146V,"ROCK COLLECTION $1 /975 /8CS",47.30
150,TP6147V,"DOUBLE RUBIES $1 /975 /8CS",47.30
150,TP6227K,"AND THEY'RE OFF $1 /740 /12CS",35.90
150,TP6379Q,"BIG BABY $1 /1275 /8CS",61.85
150,TP6380Q,"BEARLY BINGO $1 /1275 /8CS",61.85
150,TP6381Q,"TRIPLE GEMS $1 /1275 /8CS",61.85
150,TP6382Q,"WILD & FREE $1 /1275 /8CS",61.85
150,TP6548N,"RED HOT SLOTS $1 /915 /8CS",44.40
150,TP6549N,"TROLLIN' $1 /915 /8CS",44.40
150,TP6550N,"OH BABY $1 /915 /8CS",44.40
150,TP6551N,"ICEY!!! $1 /915 /8CS",44.40
150,TP6553H,"CHICK FLICK $1 /975 /8CS",47.30
150,TP6554H,"LIL' PUPS $1 /975 /8CS",47.30
150,TP6555H,"PADDY'S PRIDE $1 /975 /8CS",47.30
150,TP6556H,"WILD CHERRIES $1 /975 /8CS",47.30
150,TP6558Y,"CLASSIC SLOTS $1 /1275/ 8CS",61.85
150,TP6559Y,"DOG DAZE $1 /1275 /8CS",61.85
150,TP6560Y,"IRISH DIAMONDS $1 /1275 /8CS",61.85
150,TP6561Y,"TRIPLE THREAT $1 /1275/ 8CS",61.85
150,TP6569R,"REEL SEVENS $1 /975 /8CS",47.30
150,TP6570R,"WILD FIRE SLOTS $1 /975 /8CS",47.30
150,TP6570ZR,"LUCKY SHAMROCKS $1 /2700 /2CS",130.90
150,TP6571R,"SILVER SLOTS $1 /975 /8CS",47.30
150,TP6572R,"TRIPLE DABBIN $1 /975 /8CS",47.30
150,TP6594JR,"LUCKY KAT $1 /1960 /4CS",95.00
150,TP6645,"BUCKAROO BINGO $1 /416 /20CS",20.15
150,TP6932K,"TRIPLE 500'S $1 /2280 /4CS",110.50
150,TP6948W,"FISH 'N' CHIPS $1 /975 /8CS",39.30
150,TP6949W,"BEARLY ANGELS $1 /975 /8CS",39.30
150,TP6950W,"DALMATIAN DOLLARS $1 /975 /8CS",39.30
150,TP6951W,"PURRR-FECT $1 /975 /8CS",39.30
150,TP6991Z,"DOUBLIN DOWN $1/ 675 /12CS",32.70
150,TP7351K,"BANK BUSTERS $1 /1335/6CS",64.00
150,TP7353K,"LUCKY GOLD $1 /1335/6CS",64.00
150,TP7379S,"LIL FILLY $1 /320 /20CS",15.50
150,TP7499S,"SURE BET $1 /1320/6CS",64.00
150,TP7602H,"BANANA SPLIT $1 /1320/6CS",64.00
150,TP7603H,"TRIPLE SCORE $1 /1320/6CS",64.00
150,TP7649H,"BANANA SPLIT $1 /2460/4CS",119.20
150,TP7677L,"CHAMPION JOCKEY $1 /1965 /4CS",95.25
150,TP7685K,"WILD & LUCKY $2 /3000 /2CS",145.30
150,TP7813J,"HAWG SLOTS $1 /1965 /4CS",95.25
150,TPAC930,"ALLEY CASH $1 /930 /8CS",45.10
150,TPBB1320,"BINGO BULLDOGS $1 /1320 /6CS",64.00
150,TPBP690,"BEACH PARTY BBQ $1 /690 /12CS",33.00
150,TPDD1320,"DAZZLING DOLLARS $1 /1320 /6CS",64.00
150,TPDG960,"DOUBLE GOLD $1 /960 /8CS",46.50
150,TPEYE500R,"EYEBALLS $1 /1320 /6CS",62.10
150,TPGD1320,"GREEN DIAMONDS $1 /1320 /6CS",64.00
150,TPIS2700,"ISLAND SPLASH $1 /2700 /2CS",130.90
150,TPPOL930,"PICK OF THE LITTER $1 /930 /8C",45.10
150,TPRR1320,"RED RUBY 7 $1 /1320 /6CS",64.00
150,TPSFB500,"SUPER FAST BALL $1 1950/4CS",94.50
150,TPTW2700,"TRIPLE WISH $1 /2700 /2CS",130.90
150,UM1W1000FP,"FORE PLAY $1 / 1000 / 8CS",48.50
150,UM1W1125PH,"PICK A HORSE $1 /1125 /6CS",54.50
150,UM1W1320HHR,"HORIZONTAL HORSES $1/1320 /6CS",64.00
150,UM1W875RI,"RIDERS $1 /875 /8CS",42.40
150,UM1W900FH,"FIREHOUSE $1 /900 /8CS",43.60
150,UM6162Y,"WILD BARS $1 /1925 /4CS",93.30
150,UM6351Z,"BONUS BEES $1 /925 /8CS",44.85
150,UM6498W,"WIRE 2 WIRE $1 /1260 /6CS",61.10
150,UM6505V,"5 ALARM FIRE $1 /1260 /5CS",61.10
150,UM6847Y,"TRIPLE DAB $1 /975 /8CS",47.30
150,UM6857ZN,"SPARE CHANGE $1 /1340 /6CS",64.95
150,UM6865W,"SIX SHOT $1 /560 /10CS",27.15
150,UM7004A,"HOUNDS & HORSES $1 /2280 /4CS",110.50
150,UM7177C,"QUICK HITS $1 /1750 /4CS",84.80
150,UM7683H,"SPARE CHANGE $1 /2490/4CS",120.65
150,UM7898H,"37 PONIES $1 /925 /8CS",44.85
150,UM7906H,"MEGA 500'S $1 /2300 /4CS",111.50
150,UM7927H,"FLASHIN 4 $1 /950/8CS",46.00
150,UMCLF810,"CLEAN FINISH $1/810/12C",39.30
150,UMDUF780,"DUAL FINISH $1/780/10C",37.80
150,UMFVP600,"5 PONIES $1/600/12C",29.10
150,UMFVP960,"5 PONIES $1/960/8C",46.50
150,UMGAP780,"GET A PONY $1/780/10C",37.80
150,UMLKYC1965R,"LUCKY CLOVERS $1 /1965 /4CS",95.25
155,AI7023H,"ROYAL PALMZ $1 /6150/1CS",298.30
155,TP27877R,"POP 5 $1 /2375 /4CS",115.10
155,TP34015R,"DOUBLE CHERRIES $1 /2700 /2CS",130.90
155,TP36279RR,"FIRE & ICE $1 /1980 /4CS",96.00
155,TP36739RR,"SMOKIN' TOKENS $1 /1980 /4CS",96.00
155,TP38373R,"ZINGO $1 /1800 /4CS",87.20
155,TP46288R,"WILD & CRAZY $1 /2040 /4CS",98.85
155,TP47489R,"NAUGHTY OR NICE $2 /1995 /2CS",193.50
155,TP47624R,"MOOLAH $1 /2400 /4CS",116.30
155,TP5155CR,"FLAWLESS $1 /8080 /1CS",391.50
155,TP5213KR,"RAGS TO RICHES $2 /1995 /2CS",193.50
155,TP5300PR,"CROWN JEWEL $1 /8080 /1CS",391.50
155,TP54268R,"MEGA PALMS $1 /10050 /1CS",485.50
155,TP5430UR,"GOLD FEVER $1 /2040 /4CS",98.85
155,TP5594RR,"GOLD STANDARD $1 /6075 /1CS",294.40
155,TP5761ZR,"BIG MONEY $2 /2240 /1CS",217.25
155,TP58361RR,"BIRDS & BEES $1 /2040 /4CS",98.85
155,TP5979U,"EXACTA $1 /1980 /4CS",96.00
155,TP6006UR,"BONUS BLAZIN BALLS 1/1960 /4CS",95.00
155,TP6010XR,"SWEET & SASSY $2 /1995 /2CS",193.50
155,TP6580RR,"SQUEEZE PLAY $1 /1980 /4CS",96.00
155,TP6629Z,"BOOMERANG $1 /1800 /4CS",87.20
155,TP6703J,"ROLL THE DICE $1 /3000 /2CS",145.30
155,TP6919QR,"THUNDER & LIGHTNING $1/1995/2C",193.50
155,TP7994BR,"SI SENOR $1 /2385 /4CS",115.60
155,TPGB1980,"GUM BALLS $1 /1980 /4CS",96.00
155,UM6523Y,"DIAMOND DELUXE $1 /1980 /4CS",96.00
155,UM6933VA,"COW-A-BINGO $1 /2040/4CS",98.85
155,UM6998VA,"JELLY BEANZ $1 /2040 /4CS",98.85
155,UMCL2040,"CHICKLETS $1 /2040 /4CS",98.85
170,TP41533R,"SOUTH SEAS 3V /180 /8CS",38.75
170,TP42942R,"LUCKY DRAGON 3V /180 /8CS",38.75
170,TP49922R,"LITTLE CHEESE 3V /180 /8CS",38.75
170,TP5254SR,"MINI CLASSIC 3V /180 /8CS",38.75
170,TP5844CR,"LUCKY ELEPHANT 3V /180 /8CS",38.75
170,TP6274V,"ODD BALLS 3V /180 /8CS",38.75
170,TPBBR3,"BANANA BARS 3V /180 /8CS",38.75
170,TPDR180,"DOUBLE RAINBOW 3V /180 /8CS",38.75
170,TPFUN3R,"FUN PLAY 3V /180 /8CS",38.75
170,TPKK180RR,"KOOL KAT 3V /180 /8CS",38.75
170,TPRWB3R,"RED WHITE & BLUE 3V /180 /8CS",38.75
170,TPSD3180R,"STRIP DADDY 3V /180 /8CS",38.75
170,TPTS3R,"THREE SEVENS 3V /180 /8CS",38.75
170,TPWGC3R,"WILD GOOSE CHASE 3V /180 /8CS",38.75
180,TP41846R,"BIG CHEESE 5V /180 /8CS",60.80
180,TP5212VR,"DOWN THE STRETCH 5V /210 /8CS",71.00
180,TP5235ZR,"HEAVENLY HOG 5V /180 /8CS",60.80
180,TP5278RR,"CUSTOM SCARLET BRIGADE 5V /180",60.80
180,TP5279FR,"CUSTOM PACE SOLANO 5V /180 /8C",60.80
180,TP53053R,"BIG KAHUNA 5V /180 /8CS",60.80
180,TP5419JR,"HOT DOG 5V /180 /8CS",60.80
180,TP5485NR,"CRAZY COYOTE (C) 5V /180 /8CS",60.80
180,TP5668CR,"AMERICAN PRIDE 5V /180 /8CS",60.80
180,TP5799HR,"HALLELUJAH 5V /180 /8CS",60.80
180,TP5972BR,"FOOTHILL SQ 5V /180 /8CS",60.80
180,TP5984BR,"HOT FLASH 5V /180 /8CS",60.80
180,TP6401QR,"CLASSIC STRIP (C) 5V /180 /8CS",60.80
180,TP6466NR,"BEACH PARTY (C) 5V /180 /8CS",60.80
180,TP6691QR,"LUCKY UNICORN (C) 5V /180 /8CS",60.80
180,TP7420A,"VIKINGS 5V /180 /8CS",60.80
180,TP7748B,"LUCKY DRAGON (C) 5V /180 /8CS",60.80
180,TPAH180,"ANGRY HORSES 5V /180 /8CS",60.80
180,TPBINGO180,"BINGO STRIP 5V /180 /8CS",60.80
180,TPBOOM180R,"KA BOOM 5V /180 /8CS",60.80
180,TPDR216,"DRAGON RACE CUSTOM 5V /216/8CS",71.00
180,TPES180R,"EVEN STEVEN 5V /180 /8CS",60.80
180,TPLAF180R,"LOST & FOUND 5V /180 /8CS",60.80
180,TPLAW180R,"IN LAWS 5V /180 /8CS",60.80
180,TPLL180R,"LOUIE THE LOBSTER 5V /180 /8CS",60.80
180,TPLP180R,"LUCKY PENGUIN 5V /180 /8CS",60.80
180,TPODD180R,"ODDBALLS 5V /180 /8CS",60.80
180,TPPA180R,"PARTY ANIMALS 5V /180 /8CS",60.80
180,TPS5180R,"SUPER 5 STRIP 5V /180 /8CS",60.80
180,TPSCR180R,"SCRAPPY DOG 5V /180 /8CS",60.80
180,TPSD180R,"STRIP DADDY 5V /180 /8CS",60.80
180,TPSHO180R,"SHOW ME THE MONEY 5V /180 /8CS",60.80
180,TPSS180R,"SUPER STRIP 5V /180 /8CS",60.80
180,TPZOM180R,"ZOMBIES ARE COMING 5V /180 /8C",60.80
180,UM6108Y,"HAWG HAVEN 5V /180 /8CS",60.80
180,UM6623Z,"THE X GAME 5V /180 /8CS",60.80
180,UM6740V,"CARD SHARKS 5V /180 /8CS",60.80
180,UM7498A,"BLACKOUT 5V/180/8CS",60.80
180,UM7499A,"LUCKY CHARM 10V /180 /10CS",60.80
180,UMJ180APT,"ANIMAL PARTY 5V /180 /8CS",63.00
180,UMJ180CLV,"CLOVERS 5V /180 /8CS",63.00
180,UMJ180CRC,"CRUSTY CRABS 5V /180 /8CS",63.00
180,UMJ180PGP,"PENGUIN PALS 5V /180 /8CS",63.00
`;

        let products = [];
        let currentCategory = 'All';
        // This object will store the quantities, acting as our persistent "cart".
        let orderQuantities = {};

        function parseData() {
            const lines = inventoryData.trim().split('\n');
            const parsedProducts = lines.map(line => {
                try {
                    // Split by comma, but handle commas inside quoted names
                    const parts = [];
                    let currentPart = '';
                    let inQuotes = false;
                    for (const char of line) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            parts.push(currentPart);
                            currentPart = '';
                        } else {
                            currentPart += char;
                        }
                    }
                    parts.push(currentPart);

                    if (parts.length < 4) return null;

                    const category = parts[0].trim();
                    const itemCode = parts[1].trim();
                    const name = parts[2].trim();
                    const price = parseFloat(parts[3]);

                    if (!category || !itemCode || !name || isNaN(price)) return null;

                    return { category, itemCode, name, price };
                } catch (e) {
                    return null;
                }
            }).filter(p => p);
            return parsedProducts;
        }


        function renderTable(productsToRender) {
            const tableBody = document.getElementById('product-table-body');
            tableBody.innerHTML = '';
            productsToRender.forEach(product => {
                const row = document.createElement('tr');
                row.className = "product-row";
                row.dataset.itemCode = product.itemCode; // Use the simple item code as the unique ID
                
                const savedQuantity = orderQuantities[product.itemCode] || '';
                const lineTotal = (parseInt(savedQuantity) || 0) * product.price;

                row.innerHTML = `
                    <td class="hidden px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product.itemCode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${product.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">$${product.price.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <input type="number" min="0" value="${savedQuantity}" class="w-24 p-2 bg-gray-50 border border-gray-300 rounded-md text-center focus:ring-1 focus:ring-blue-500 focus:border-blue-500 quantity-input">
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-semibold text-right line-total">$${lineTotal.toFixed(2)}</td>
                `;
                tableBody.appendChild(row);
            });
            addEventListenersToInputs();
        }

        function calculateTotals() {
            let grandTotal = 0;
            for (const itemCode in orderQuantities) {
                const quantity = orderQuantities[itemCode];
                if (quantity > 0) {
                    const product = products.find(p => p.itemCode === itemCode);
                    if (product) {
                        grandTotal += quantity * product.price;
                    }
                }
            }
            document.getElementById('total-price').textContent = `$${grandTotal.toFixed(2)}`;

            document.querySelectorAll('.product-row').forEach(row => {
                const itemCode = row.dataset.itemCode;
                const quantity = orderQuantities[itemCode] || 0;
                const product = products.find(p => p.itemCode === itemCode);
                if (product) {
                    const lineTotal = quantity * product.price;
                    row.querySelector('.line-total').textContent = `$${lineTotal.toFixed(2)}`;
                }
            });
        }

        function addEventListenersToInputs() {
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const itemCode = e.target.closest('.product-row').dataset.itemCode;
                    const quantity = parseInt(e.target.value) || 0;
                    
                    if (quantity > 0) {
                        orderQuantities[itemCode] = quantity;
                    } else {
                        delete orderQuantities[itemCode];
                    }
                    
                    calculateTotals();
                });
            });
        }
        
        function filterAndRender() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filteredProducts = products;

            if (currentCategory !== 'All') {
                filteredProducts = filteredProducts.filter(p => p.category === currentCategory);
            }

            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.itemCode.toLowerCase().includes(searchTerm)
                );
            }
            
            renderTable(filteredProducts);
        }
        
        function showOrderSummary() {
            const customerName = document.getElementById('customerName').value;
            const email = document.getElementById('email').value;

            if (!customerName || !email) {
                alert('Please fill in at least Customer Name and Email Address.');
                return;
            }

            const modal = document.getElementById('order-summary-modal');
            const customerDetails = document.getElementById('modal-customer-details');
            const productSummary = document.getElementById('modal-product-summary');
            const modalTotalPrice = document.getElementById('modal-total-price');
            
            customerDetails.innerHTML = `
                <p><strong>Name:</strong> ${document.getElementById('customerName').value}</p>
                <p><strong>Company:</strong> ${document.getElementById('companyName').value || 'N/A'}</p>
                <p><strong>Email:</strong> ${document.getElementById('email').value}</p>
                <p><strong>Phone:</strong> ${document.getElementById('phone').value || 'N/A'}</p>
                <p><strong>Shipping Address:</strong> ${document.getElementById('shippingAddress').value || 'N/A'}</p>
                 <p><strong>Special Instructions:</strong> ${document.getElementById('specialInstructions').value || 'N/A'}</p>
            `;

            let summaryHtml = '<div class="divide-y divide-gray-200">';
            let hasProducts = false;
            let grandTotal = 0;

            for (const itemCode in orderQuantities) {
                 const quantity = orderQuantities[itemCode];
                 if (quantity > 0) {
                    hasProducts = true;
                    const product = products.find(p => p.itemCode === itemCode);
                    if (product) {
                        const lineTotal = quantity * product.price;
                        grandTotal += lineTotal;
                        summaryHtml += `
                            <div class="py-2 flex justify-between">
                                <div>
                                    <p class="font-semibold">${product.name} (${product.itemCode})</p>
                                    <p class="text-sm text-gray-600">${quantity} x $${product.price.toFixed(2)}</p>
                                </div>
                                <p class="font-semibold">$${lineTotal.toFixed(2)}</p>
                            </div>
                        `;
                    }
                 }
            }
            summaryHtml += '</div>';

            if (!hasProducts) {
                alert('Please select a quantity for at least one product.');
                return;
            }

            productSummary.innerHTML = summaryHtml;
            modalTotalPrice.textContent = `$${grandTotal.toFixed(2)}`;
            modal.classList.remove('hidden');
        }
        
        function closeModal() {
            document.getElementById('order-summary-modal').classList.add('hidden');
        }

        function handleConfirmOrder() {
            const customerName = document.getElementById('customerName').value;
            const companyName = document.getElementById('companyName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const shippingAddress = document.getElementById('shippingAddress').value;
            const specialInstructions = document.getElementById('specialInstructions').value;

            const subject = `New Customer Order from ${customerName}`;

            let body = "New Order Details:\n\n";
            body += "--- Customer Information ---\n";
            body += `Name: ${customerName}\n`;
            body += `Company: ${companyName || 'N/A'}\n`;
            body += `Email: ${email}\n`;
            body += `Phone: ${phone || 'N/A'}\n`;
            body += `Shipping Address: ${shippingAddress || 'N/A'}\n`;
            body += `Special Instructions: ${specialInstructions || 'N/A'}\n\n`;
            body += "--- Ordered Products ---\n\n";

            let grandTotal = 0;
            for (const itemCode in orderQuantities) {
                const quantity = orderQuantities[itemCode];
                if(quantity > 0) {
                    const product = products.find(p => p.itemCode === itemCode);
                    if (product) {
                        const lineTotal = quantity * product.price;
                        grandTotal += lineTotal;
                        body += `${product.name} (${itemCode})\n`;
                        body += `   - Quantity: ${quantity}\n`;
                        body += `   - Price per deal: $${product.price.toFixed(2)}\n`;
                        body += `   - Subtotal: $${lineTotal.toFixed(2)}\n\n`;
                    }
                }
            }

            body += "---------------------------\n";
            body += `GRAND TOTAL: $${grandTotal.toFixed(2)}\n`;

            const mailtoLink = `mailto:jeffrey.rydman@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            
            closeModal();

            const successMessage = document.getElementById('success-message');
            successMessage.classList.remove('hidden');
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 5000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            products = parseData();
            filterAndRender();
            
            document.getElementById('searchInput').addEventListener('input', filterAndRender);
            
            document.getElementById('category-filters').addEventListener('click', (e) => {
                if (e.target.classList.contains('category-btn')) {
                    document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.category;
                    filterAndRender();
                }
            });

            document.getElementById('submit-order').addEventListener('click', showOrderSummary);
            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('confirm-order').addEventListener('click', handleConfirmOrder);
        });

    </script>
</body>
</html>

